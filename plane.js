define(["coord","ball","path"],function(k,i,j){function b(a,d,b,c){this.vx=this.vy=this.waypoint=this.frame=0;this.path=null;this.scale=1;this.minScale=0.125;this.init(c);this.pos=new i(a.x,a.y,Math.round(Math.max(d.width,d.height)/2));this.width=d.width;this.height=d.height;this.landing=this.selected=!1;this.img=new Image;this.initMask(b,d)}b.prototype.init=function(){};b.prototype.hasPath=function(){return null!=this.path};b.prototype.getHeading=function(){return Math.atan2(this.vy,this.vx)};b.prototype.setHeading=
function(a){var b=this.velocity();this.vx=b*Math.cos(a);this.vy=b*Math.sin(a)};b.prototype.setScale=function(a){this.scale=a<=this.minScale?this.minScale:a;this.pos.r=Math.round(Math.max(this.width,this.height)/2*this.scale)};b.prototype.setPath=function(a){this.path=(new j).fromOther(a);this.waypoint=1};b.prototype.nextWaypoint=function(){this.hasPath()&&this.path.shift()};b.prototype.velocity=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)};b.prototype.setVelocity=function(a){var b=
this.getHeading();this.vx=a*Math.cos(b);this.vy=a*Math.sin(b)};b.prototype.dist=function(a){return this.pos.dist(a)};b.prototype.draw=function(a){a.save();a.translate(this.pos.x,this.pos.y);a.rotate(this.getHeading()+Math.PI/2);a.drawImage(this.img,-this.width*this.scale/2,-this.height*this.scale/2,this.width*this.scale,this.height*this.scale);this.selected&&(a.strokeStyle="yellow",a.beginPath(),a.arc(0,0,this.pos.r,0,2*Math.PI,!1),a.stroke());a.restore()};b.prototype.clear=function(a){a.save();a.translate(this.pos.x,
this.pos.y);a.rotate(this.heading+Math.PI/2);a.clearRect(-(this.pos.r+3),-(this.pos.r+3),2*(this.pos.r+3),2*(this.pos.r+3));a.restore()};b.prototype.initMask=function(a,b){var f=document.createElement("canvas");f.width=this.width;f.height=this.height;var c=f.getContext("2d");c.drawImage(a,0,0);for(var h=c.getImageData(0,0,this.width,this.height),g=h.data,e=g.length-1;0<e;e-=4)g[e]=255-g[e-3];c.clearRect(0,0,this.width,this.height);c.putImageData(h,0,0);c.globalCompositeOperation="xor";c.drawImage(b,
0,0);this.img.src=f.toDataURL("image/png")};b.prototype.move=function(a){this.pos.move(a.x,a.y)};b.prototype.land=function(a){this.setPath(a);this.move(this.path[0]);this.heading=Math.atan2(a[1].y-this.pos.y,a[1].x-this.pos.x);console.log("Set heading  vx:"+this.vx+" vy:"+this.vy+" Dist(path0):"+this.dist(this.path[0]));this.landing=!0;var b=this.velocity();this.a=0.5*(-b*b/this.dist(a[1]));console.log("Lib 249: Set acceleration to "+this.a+". v: "+b+" dist:"+this.dist(a[1]))};return b});